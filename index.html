<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <link rel="stylesheet" href="style.css">
    <div class="top_nav">
        <div>0</div>
        <div>10/10</div>
    </div>
    <canvas id="cvs"></canvas>
    <div class="bottom_nav">
        <button onclick="spawn_minion(1)">
            <img src="img/minion1.png">
        </button>
        <button onclick="spawn_minion(2)">
            <img src="img/minion2.png">
        </button>
    </div>
    <script>
        const cvs = document.getElementById('cvs');
        const ctx = cvs.getContext('2d');

        var minion_list = [];
        var img_list = [
            "img/gold.png",
            "img/minion1.png",
            "img/minion2.png"
        ];
        var direction_list = [
            [0, 1],
            [1, 1],
            [1, 0],
            [0, 0],
            [0, -1],
            [-1, 0],
            [-1, -1],
            [1, -1],
            [-1, 1]
        ]

        var gold = 0;
        var max_minion = 10;

        class Minion {
            constructor(l) {
                this.x = cvs.width / 2;
                this.y = cvs.height / 2;
                this.level = l;
                this.is_move = false;
                this.is_cool = false;
                this.timer = 0;
                this.coolt = 180;
                this.xspeed = 0.2 * l;
                this.yspeed = 0.2 * l;
                this.cost = 50 * l;
                this.img = new Image();
            }
            draw() {
                this.img.src = img_list[l];
                ctx.drawImage(this.img, 0, 0);
            }
        }

        function update() {
            requestAnimationFrame(update);

            ctx.clearRect(0, 0, cvs.width, cvs.height);

            draw_all_minion();
        }

        function spawn_minion(i) {
            c = 50 * i
            if (check_can_buy(c)) {
                m = new Minion(i);
                gold -= m.cost;
                minion_list.push(m);
            } else {
                console.log('골드가 부족합니다');
            }
        }

        function check_can_buy(cst) {
            if (gold >= cst) {
                return true;
            } else { 
                return false;
            }
        }

        function draw_all_minion() {
            for (let i = 0; i < minion_list.length; i++) {
                t = minion_list[i];
                move_minion(t);
                t.draw();
            }
        }

        function move_minion(mi) {
            if (mi.is_move) {
                // 이동 시간이 남았는지 체크
                if (mi.timer == 0) {
                    mi.is_move = false;
                    mi.is_cool = true;
                } else {
                    mi.x += mi.xspeed;
                    mi.y += mi.yspeed;
                    get_gold(mi);
                    mi.timer -= 1;
                }
            } else {
                if (mi.is_cool) {
                    mi.coolt -= 1;
                    if (mi.coolt == 0) {
                        console.log("휴식 완료");
                        mi.is_cool = false;
                    }
                } else {
                    // 초기화 작업
                    mi.coolt = 180;
                    mi.xspeed = mi.level * 0.2;
                    mi.yspeed = mi.level * 0.2;

                    // 랜덤값 설정
                    rt = Math.floor(Math.random() * (5 - 2) + 2);
                    dlst = setting_direction();
                    mi.xspeed *= dlst[0];
                    mi.yspeed *= dlst[1];
                    mi.timer = rt;

                    console.log(mi.xspeed, mi.yspeed, mi.timer);

                    mi.is_move = true;
                }
            }
        }

        function setting_direction() {
            r = Math.floor(Math.random() * (8 - 0) + 0);
            return direction_list[r];
        }

        function get_gold(t) {
            g = t.level + Math.floor(level / 3) * 10 + Math.floor(level / 5) * 30;
            gold += g;
        }

        function get_exp(i) {

        }
    </script>
</body>
</html>